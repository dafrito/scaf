# This must always contain a package-specific subdirectory
PKGDATADIR=${DATADIR}/scaf

APP=scaf

all: ${APP}
.PHONY: all

Makefile: Makefile.in configure
	./configure ${PREFIX}

${APP}: Makefile
	echo "#!/bin/bash"                                >$@-wip
	echo "# Autogenerated this executable at `date`" >>$@-wip
	echo "# DO NOT EDIT THIS FILE!"                  >>$@-wip
	echo                                             >>$@-wip
	echo "SCAF_INSTALLED=true"                       >>$@-wip
	echo "SCAF=${BINDIR}/scaf"                       >>$@-wip
	echo "SCAFDIR=${PKGDATADIR}"                     >>$@-wip
	echo                                             >>$@-wip
	echo "source ${PKGDATADIR}/run.sh"               >>$@-wip
	chmod +x $@-wip
	chmod ugo-w $@-wip
	rm -f $@
	mv $@-wip $@

install: uninstall ${APP} | ${BINDIR} ${PKGDATADIR}
	test -n ${BINDIR}
	test -n ${PKGDATADIR}
	cp ${APP} ${BINDIR}
	cp -r data types.d *.sh ${PKGDATADIR}
.PHONY: clean

${BINDIR} ${PKGDATADIR}:
	mkdir -p $@

uninstall:
	# Verify these variables are given
	test -n ${BINDIR}
	test -n ${APP}
	test -n ${PKGDATADIR}
	rm -f ${BINDIR}/${APP}
	rm -rf ${PKGDATADIR}
.PHONY: uninstall

clean:
	rm -f ${APP} *-wip
.PHONY: clean

realclean: clean
	rm -f Makefile
.PHONY: realclean
